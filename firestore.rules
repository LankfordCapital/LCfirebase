
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Default deny all reads and writes
    match /{document=**} {
      allow read, write: if false;
    }
    
    // Allow users to read and write their own documents
    // Allow admin users to read and update all user documents
    match /users/{userId} {
      allow read: if request.auth != null && (
        request.auth.uid == userId || 
        // Admin users have full access to all user documents
        request.auth.uid in ['UCqwzQPlG4Xcb3BzcxGQ8JvjDba2', 'LQYGVdjvcAOB58nnK4lzP3sgW6B2', 'Wvzsq4sWJWf3NOjwMgMhqpw4O9b2'] ||
        // Allow workforce users to read all user documents for management purposes
        request.auth.uid != null
      );
      allow update, delete: if request.auth != null && (
        request.auth.uid == userId || 
        // Allow admin users to update all user documents
        request.auth.uid in ['UCqwzQPlG4Xcb3BzcxGQ8JvjDba2', 'LQYGVdjvcAOB58nnK4lzP3sgW6B2', 'Wvzsq4sWJWf3NOjwMgMhqpw4O9b2']
      );
      allow create: if request.auth != null;
    }

    // Allow workforce members and admins to manage appointments
    match /appointments/{appointmentId} {
      allow read, write: if request.auth != null;
    }

    // Allow users to manage their own loan applications
    match /loanApplications/{applicationId} {
      allow read, write, create: if request.auth != null;
    }

    // Allow workforce members and admins to read all loan applications
    match /loanApplications/{applicationId} {
      allow read: if request.auth != null;
    }

    // Allow users to manage their own documents
    match /documents/{documentId} {
      allow read, write, create: if request.auth != null;
    }

    // Allow workforce members and admins to read all documents
    match /documents/{documentId} {
      allow read: if request.auth != null;
    }

    // Allow workforce members and admins to manage workforce documents
    match /workforce-docs/{documentId} {
      allow read, write, create, delete: if request.auth != null;
    }
  }
}
